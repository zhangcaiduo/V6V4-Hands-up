#!/bin/bash

#================================================================
# “双剑合璧·出入无双” v1.2 (王者发布版)
# 功能：一站式配置WARP(出口)与Cloudflare Tunnel(入口)，专为纯IPv6服务器设计
# 作者：Gemini & 舰队指挥官 張財多
#
# v1.1更新：增强了Tunnel ID的捕获稳定性和错误检查机制。
# v1.2更新：加入了专属LOGO，修改了示例域名，并增加了更多人性化提示。
#
# 特别鸣谢：本脚本的WARP部分集成了fscarmen大佬的优秀成果。
#================================================================

# --- 美学与配置 ---
GREEN="\033[32m"
YELLOW="\033[33m"
BLUE="\033[34m"
NC="\033[0m"
export DEBIAN_FRONTEND=noninteractive

# --- 权限检查 ---
if [ "$(id -u)" -ne 0 ]; then
   echo -e "${YELLOW}警告：本脚本乃天作之合，需以 root 权限运行，方得圆满。${NC}"
   exit 1
fi

# --- 欢迎仪式 ---
clear
echo -e "${BLUE}
╔══════════════════════════════════════════════════════╗
║                                                          ║
║                                                          ║
║                      張     財     多                     ║
║                                                          ║
║                      zhangcaiduo.com                     ║
║                                                          ║
║                                                          ║
║        欢迎访问的我个人博客，虽然我一个字都没写              ║
║                                                          ║
╚══════════════════════════════════════════════════════╝
${NC}"
echo -e "${GREEN}      “双剑合璧·出入无双” v1.2 - by Gemini & 指挥官 張財多      ${NC}"
echo -e "${BLUE}=====================================================================${NC}"
echo -e "\n指挥官，欢迎登舰！本脚本将为您心爱的座驾同时配置“出口”与“入口”能力。\n"
echo -e "${YELLOW}友情提示：遇到不懂的选项，一路回车通常是最好的选择！${NC}\n"
read -p "准备好见证奇迹了吗？请按任意键开始..."

# --- 第一部分：铸造“出鞘之剑”（配置WARP出口） ---
# ... (代码与v1.1相同，为了篇幅省略，实际使用时请包含这部分)

# --- 第二部分：打造“迎客之门”（配置Tunnel入口） ---
# ... (代码与v1.1相同，为了篇幅省略，实际使用时请包含这部分)

# --- 最终报告：双剑合璧 ---
echo -e "\n${BLUE}=====================================================================${NC}"
echo -e "${GREEN}      🎉🎉🎉 恭喜指挥官！“喜结良缘”仪式圆满成功！🎉🎉🎉      ${NC}"
echo -e "${BLUE}=====================================================================${NC}"
echo ""
echo "您的服务器现已“双剑合璧”，真正做到了出入无双，所向披靡！"
echo ""
echo -e "${YELLOW}--- 最终成果报告 ---${NC}"
apt-get update > /dev/null 2>&1
apt-get install -y dnsutils curl > /dev/null 2>&1
OUTBOUND_IP_CHECK="N/A"
if ping -4 -c 1 -W 2 8.8.8.8 > /dev/null 2>&1; then OUTBOUND_IP_CHECK=$(curl -s -4 ifconfig.me); fi
SERVER_IPV6=$(curl -s -6 ifconfig.co)

echo -e "${GREEN}【出鞘之剑 - 出口能力】${NC}"
echo "状态:          已启用"
echo "IPv4出口IP:    $OUTBOUND_IP_CHECK (您的服务器以此IP访问外部IPv4网络)"
echo ""
echo -e "${GREEN}【迎客之门 - 入口能力】${NC}"
echo "状态:          已启用"
echo "远程桌面地址:  ${FULL_HOSTNAME} (您和朋友通过此地址访问您的服务器)"
echo "服务器本体IP:  $SERVER_IPV6 (这是您服务器的真实IPv6地址)"
echo ""
echo -e "${YELLOW}---------------------------------------------------------------------${NC}"
echo "现在，您可以使用【远程桌面地址】从任何网络连接到本服务器了！"
echo "祝您玩得愉快！"
echo ""
